From 767fe90f7a3e31728343fefc4e3984430ea7d067 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Samuel=20Iglesias=20Gons=C3=A1lvez?= <siglesias@igalia.com>
Date: Wed, 25 Jan 2017 10:28:59 +0100
Subject: [PATCH 01/37] i965/fs: fix opt_peephole_sel() when dealing with
 conversions
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Don't lower a type conversion because SEL does't support type conversions.

Signed-off-by: Samuel Iglesias Gons√°lvez <siglesias@igalia.com>
---
 src/mesa/drivers/dri/i965/brw_fs_sel_peephole.cpp | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/mesa/drivers/dri/i965/brw_fs_sel_peephole.cpp b/src/mesa/drivers/dri/i965/brw_fs_sel_peephole.cpp
index 8cd897f72e0..8a9f6e67a14 100644
--- a/src/mesa/drivers/dri/i965/brw_fs_sel_peephole.cpp
+++ b/src/mesa/drivers/dri/i965/brw_fs_sel_peephole.cpp
@@ -167,6 +167,8 @@ fs_visitor::opt_peephole_sel()
              then_mov[i]->force_writemask_all != else_mov[i]->force_writemask_all ||
              then_mov[i]->is_partial_write() ||
              else_mov[i]->is_partial_write() ||
+             type_sz(then_mov[i]->dst.type) != type_sz(then_mov[i]->src[0].type) ||
+             type_sz(else_mov[i]->dst.type) != type_sz(else_mov[i]->src[0].type) ||
              then_mov[i]->conditional_mod != BRW_CONDITIONAL_NONE ||
              else_mov[i]->conditional_mod != BRW_CONDITIONAL_NONE) {
             movs = i;
-- 
2.11.0


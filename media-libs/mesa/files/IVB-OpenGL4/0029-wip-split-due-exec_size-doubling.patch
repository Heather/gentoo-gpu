From 9658b5186f4c3e0865c0665b52028885ba04b3c3 Mon Sep 17 00:00:00 2001
From: "Juan A. Suarez Romero" <jasuarez@igalia.com>
Date: Tue, 10 Jan 2017 11:32:06 +0100
Subject: [PATCH 29/34] wip: split due exec_size doubling

---
 src/mesa/drivers/dri/i965/brw_fs.cpp | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/src/mesa/drivers/dri/i965/brw_fs.cpp b/src/mesa/drivers/dri/i965/brw_fs.cpp
index 19e162377e1..aa8bc4972bf 100644
--- a/src/mesa/drivers/dri/i965/brw_fs.cpp
+++ b/src/mesa/drivers/dri/i965/brw_fs.cpp
@@ -5121,6 +5121,12 @@ fs_visitor::lower_simd_width()
    foreach_block_and_inst_safe(block, fs_inst, inst, cfg) {
       const unsigned lower_width = get_lowered_simd_width(devinfo, inst);
 
+      if (devinfo->gen == 7 && !devinfo->is_haswell &&
+          (get_exec_type_size(inst) == 8 || type_sz(inst->dst.type) == 8)) {
+         unsigned new_lower_width = MIN2(lower_width, dispatch_width / 2);
+         assert(new_lower_width  != lower_width);
+      }
+
       if (lower_width != inst->exec_size) {
          /* Builder matching the original instruction.  We may also need to
           * emit an instruction of width larger than the original, set the
-- 
2.11.0


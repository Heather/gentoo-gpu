From 7e03b38a4889a78ac13d774f65d6ef702afbc886 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Samuel=20Iglesias=20Gons=C3=A1lvez?= <siglesias@igalia.com>
Date: Fri, 10 Feb 2017 10:24:48 +0100
Subject: [PATCH 28/37] FIX d2x
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

Signed-off-by: Samuel Iglesias Gons√°lvez <siglesias@igalia.com>
---
 src/mesa/drivers/dri/i965/brw_fs_lower_d2x.cpp | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/mesa/drivers/dri/i965/brw_fs_lower_d2x.cpp b/src/mesa/drivers/dri/i965/brw_fs_lower_d2x.cpp
index cec42d54cb8..b045232a9d8 100644
--- a/src/mesa/drivers/dri/i965/brw_fs_lower_d2x.cpp
+++ b/src/mesa/drivers/dri/i965/brw_fs_lower_d2x.cpp
@@ -57,7 +57,10 @@ fs_visitor::lower_d2x()
        */
       fs_reg temp = ibld.vgrf(inst->src[0].type, 1);
       fs_reg strided_temp = subscript(temp, inst->dst.type, 0);
-      ibld.emit(inst->opcode, strided_temp, inst->src[0], inst->src[1], inst->src[2]);
+      fs_inst *strided_inst = new(ibld.shader->mem_ctx) fs_inst(*inst);
+      strided_inst->dst = strided_temp;
+      strided_inst->size_written *= 2;
+      ibld.emit(strided_inst);
       ibld.MOV(dst, strided_temp);
 
       inst->remove(block);
-- 
2.11.0

